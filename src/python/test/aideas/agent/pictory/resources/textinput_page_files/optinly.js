var OptinlyDeviceDetect={detect:function(e){return void 0===e&&(e={}),this.mm=window.matchMedia,this.mm&&!e.useUA?(this.method="media queries",this.type=this.mq()):(this.method="user agent strings",this.type=this.ua()),e.verbose?[this.type,this.method]:this.type},mq:function(){return this.minMatch(320)&&this.maxMatch(700)?"smartphone":this.minMatch(768)&&this.maxMatch(1024)?"tablet":"desktop"},match:function(e,t){return window.matchMedia("screen and ("+e+"-device-width: "+t+"px)").matches},minMatch:function(e){return this.match("min",e)},maxMatch:function(e){return this.match("max",e)},ua:function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))?"smartphone":"desktop"}},OptinlyHelpers={setCookie:function(e,t,i,n){let o=24,r=i;"hours"===n?(o=i,r=1):"days"===n?r=i:"weeks"===n&&(r=7*i);var s=new Date;s.setTime(s.getTime()+o*r*60*60*1e3);var a="expires="+s.toGMTString();document.cookie=e+"="+t+"; "+a+"; path=/"},getScale:function(e){var t=this.getZoomValue();return this.getWindowWidth()*t/(e.getBoundingClientRect().width*t)},getCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(-1!=o.indexOf(t))return o.substring(t.length,o.length)}return""},isArray:e=>Array.isArray(e),loadCss:function(e){if(document.createStyleSheet)document.createStyleSheet(e);else{var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}},size:e=>Array.isArray(e)?e.length:0,inheritPrototype:function(e,t){var i=Object.create(t.prototype);i.constructor=e,e.prototype=i},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))},forEach:function(e,t,i){for(var n=0,o=e.length;n<o;++n)n in e&&t.call(i,e[n],n,e)},isMobile:function(){return"smartphone"==OptinlyDeviceDetect.detect()},isTablet:function(){return"tablet"==OptinlyDeviceDetect.detect()},isDesktop:function(){return"desktop"==OptinlyDeviceDetect.detect()},createLoadEvent:function(e){var t=this;"complete"!==document.readyState&&"loaded"!=document.readyState&&"interactive"!=document.readyState?document.addEventListener?(document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),e()},!1),window.addEventListener("load",function(){t.createLoadEvent(e)},!1)):(document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),e())}),document.documentElement.doScroll&&window==window.top&&function(){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}e()}()),window.addEventListener?window.addEventListener("onload",e,!1):window.attachEvent("onload",e)):e()},extendObject:function(e,t){for(var i in t)e[i]=t[i];return e},getAnId:function(){return"-"+Math.random().toString(36).substr(2,9)},get(e,t,i){try{return(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&t.length>1?get(e,t.slice(1),i):void 0===e?i:e}catch(e){return i||void 0}},pushEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},getZoomValue:function(){var e=90==Math.abs(window.orientation);return(320==window.screen.width?e?480:320:window.screen[e?"height":"width"])/window.innerWidth},getWindowWidth:function(){var e=0;if("number"==typeof window.innerWidth)e=window.innerWidth;else{var t=document.documentElement.clientHeight,i=document.body.clientHeight;e=t>0?t:i}return e},getWindowHeight:function(){var e=0;if("number"==typeof window.innerHeight)e=window.innerHeight;else{var t=document.documentElement.clientHeight,i=document.body.clientHeight;e=t>0?t:i}return e},getDocumentWidth:function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth)},getScrlRoot:function(){var e;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&document.body.scrollTop?e=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(e=document.documentElement.scrollTop),e},getScrlY:function(){return(this.getScrlRoot()+this.getWindowHeight())/this.getDocumentHeight()*100},hasClass:function(e,t){return!!e&&e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){OptinlyHelpers.hasClass(e,t)||(e.className+=" "+t)},replaceAll:(e,t,i)=>e.split(t).join(i),removeClass:function(e,t){if(OptinlyHelpers.hasClass(e,t)){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i," ")}},checkEnabledOnPage(rules={},def){var url_rule=rules.urlPath;return"(true)"===url_rule?def:(url_rule=OptinlyHelpers.replaceAll(url_rule,"window.location.href","decodeURIComponent(window.location.href)"),url_rule=OptinlyHelpers.replaceAll(url_rule,"window.location.search","decodeURIComponent(window.location.search)"),url_rule=OptinlyHelpers.replaceAll(url_rule,"window.location.pathname","decodeURIComponent(window.location.pathname)"),eval(url_rule))},getElementsByClassName:function(e,t){if(document.getElementsByClassName)return e&&e.getElementsByClassName?e.getElementsByClassName(t):document.getElementsByClassName(t);for(var i=[],n=new RegExp("(^| )"+t+"( |$)"),o=e.getElementsByTagName("*"),r=0,s=o.length;r<s;r++)n.test(o[r].className)&&i.push(o[r]);return i},indexOf:(e,t)=>Array.isArray(e)?e.indexOf(t):-1,strIndexOf:(e,t)=>String(e).indexOf(t),getSiteScrollTop:function(){var e;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&document.body.scrollTop?e=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(e=document.documentElement.scrollTop),e},getDocumentHeight:function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)},insertImage:function(e,t,i,n){var o=document.createElement("img");o.src=e,o.id=n,o.style.display="none",t&&(o.width=t),i&&(o.height=i),document.body.appendChild(o)},logger(e="",t=""){"dev"===sessionStorage.getItem("optinly_environment")&&(t?console.log(t," : ",e):console.log(e))},isTruthy:e=>"true"===e||!0===e,getCookiePairs(){const e=document.cookie.split(";"),t=[];for(var i=0;i<e.length;i++){pair=e[i].split("=");var n=null==pair[0]?"":pair[0].trim();value=null==pair[1]?"":pair[1].trim(),n&&t.push({key:n,value:value})}return t},appendStyle(e){try{_optJquery("<style>").text(e).appendTo(document.head)}catch(e){console.log(e)}},setIdleTimeout(e,t){var i=0;function n(){i=setTimeout(o,e),document.addEventListener("mousemove",r),document.addEventListener("keypress",r),document.addEventListener("scroll",r)}function o(){i=0,t()}function r(){i&&clearTimeout(i),document.removeEventListener("mousemove",r),document.removeEventListener("keypress",r),document.removeEventListener("scroll",r),setTimeout(n,1e3)}n()}};function OptinlyMain(e){this.campaign=e,this.rules=e.rules,this.is_ready=!1,this.hide_=!1,this.subscribed=!1,this.is_prepared=!1,this.isLoadedHtml=null,this.frameReady=!1,this.customerId=_opt.customerId,this.frameId=OptinlyHelpers.getAnId(),this.isDev=1==e.isDev,this.retryModuler=null,this.backendBaseUrl=e.backendBaseUrl,this.cdnBaseUrl=e.cdnBaseUrl,this.sitesBaseUrl=e.sitesBaseUrl,this.analyticsUrl=e.analyticsUrl,this.campaign_id=this.campaign.campaign_id,this.triggerPopupButtonAttr="data-is-optinly-popup-opened",this.embedded=e.embedded,void 0!==_opt&&OptinlyHelpers.extendObject(this.rules,_opt||{}),this.showStrictly=!!this.rules&&(this.rules.showStrictly&&!this.subscribed)}OptinlyMain.prototype._afterPrepare=function(){this.is_prepared=!0;this.campaign.type;this.getHTML()},OptinlyMain.prototype.getHTML=function(){var e=this;if(this.isLoadedHtml)this.loadHTML(this.isLoadedHtml);else{var t="";(t=(this.isDev,e.sitesBaseUrl+"sites/"+this.campaign.site_id+"/"+this.campaign.campaign_id+"/index.html"))&&OptinlyAjax.send(t,function(t){t=String(t).replace(/optinly-popup-frame/g,"optinly-popup-moduler"),e.isLoadedHtml=t,e.loadHTML(t)},"GET",{},!0)}},OptinlyMain.prototype._writeHTML=function(e,t){e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument;e.srcdoc=t},OptinlyMain.prototype.getCampaignId=function(){return this.campaign.campaign_id},OptinlyMain.prototype.frameLoaded=function(e,t){this.resizeCampaign(e,t),this.frameReady=!0;const i=this;this.rules.showOnScroll&&this.setUpScrollShow(e),this.rules.showOnInActive&&OptinlyHelpers.setIdleTimeout(parseInt(1e3*this.rules.inActiveTime),function(){i.show()}),_optJquery(document).keyup(function(e){"Escape"!==e.key&&27!=e.keyCode||i.hide()})},OptinlyMain.prototype.resizeCampaign=function(){},OptinlyMain.prototype.preResize=function(e,t){this.rules.iframeWidth=e,this.rules.iframeHeight=t},OptinlyMain.prototype.isClickToTrigger=function(){return OptinlyHelpers.isTruthy(this.rules.clickToTrigger)},OptinlyMain.prototype.prepareTriggerElements=function(){return this.rules.triggerElements},OptinlyMain.prototype.toggleClickToTriggerAttribute=function(e=this.optinly_triggering_button){try{const t=_optJquery;"true"==t(e).attr(this.triggerPopupButtonAttr)?t(e).attr(this.triggerPopupButtonAttr,"false"):t(e).attr(this.triggerPopupButtonAttr,"true")}catch(e){console.log(e)}},OptinlyMain.prototype.onCloseOrSubscribed=function({close:e,subscribed:t}){this.isClickToTrigger()&&this.optinly_triggering_button&&(t?(document.removeEventListener("click",this.clickToTriggerListener,!0),_optJquery(this.optinly_triggering_button)[0]&&_optJquery(this.optinly_triggering_button)[0].click()):this.toggleClickToTriggerAttribute())},OptinlyMain.prototype.setUpClickToTrigger=function(e){const t=this,i=t.rules.triggerCondition;String(i).split(", ").map(e=>String(e).trim()).join(",").length>1&&(this.clickToTriggerListener=function(e){let n;if(String(i).split(",").map(t=>{!n&&_optJquery(e.target).closest(t)[0]&&(n=_optJquery(_optJquery(e.target).closest(t)[0]))}),!n)return!0;if(t.optinly_triggering_button=n,"true"==n.attr(t.triggerPopupButtonAttr))return!0;n&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.hide_=!1,t.show(e),t.toggleClickToTriggerAttribute(n))},document.addEventListener("click",t.clickToTriggerListener,!0))},OptinlyMain.prototype.onIframeClick=function(e){_optJquery(`.${e}-${this.campaign.campaign_id}`).click()},OptinlyMain.prototype.preShow=function(e){var t=this;const i=this.hide_||this.subscribed;return!e&&i&&(result=!1),this.is_prepared||this.startPrepare(),this.frameReady?(clearInterval(this.retryModuler),this.sendEvent("view_count"),result=!0):(clearInterval(this.retryModuler),this.retryModuler=setInterval(function(){t.isClickToTrigger()?(t.frameReady=!0,clearInterval(t.retryModuler),t.setUpClickToTrigger(e)):t.show(e)},500),result=!1),OptinlyHelpers.checkEnabledOnPage(this.campaign.rules,!0)?result:(t.frameReady=!1,!1)},OptinlyMain.prototype.setUpScrollShow=function(e){const t=this;window.onscroll=function(){if(Math.floor(OptinlyHelpers.getScrlY())>=parseInt(t.rules.scrollValue)){if(t.formVisible||t.hide_)return;t.show(e),t.hide_=!0}}},OptinlyMain.prototype.sendEvent=function(e){if(["view_count"].indexOf(e)<0)return;var t=`${this.analyticsUrl}?campaign_id=${this.campaign.campaign_id}&site_id=${this.campaign.site_id}&view_count=1&cache=${(new Date).getTime()}`;document.location.href&&(t+="&domain="+encodeURIComponent(document.location.href)),this.customerId&&(t+="&customerId="+this.customerId);const i="optinly-pixel-"+e+"-"+this.campaign_id;document.getElementById(i)||OptinlyHelpers.insertImage(t,1,1,i)},OptinlyMain.prototype.OnSubscribed=function(e){this.subscribed=!0;const t=this;OptinlyHelpers.setCookie("optinly_subscribed_"+this.campaign.campaign_id,"true",this.rules.subscribedCookieDuration||365);this.rules.closeInSeconds&&this.rules.closeInSeconds;if(this.rules.redirectAfterSubscribe&&this.rules.redirectURL){var i=this.rules.redirectURL;setTimeout(function(){try{const n={};if(!e)return document.location.href=i;if(OptinlyHelpers.isTruthy(t.rules.append_subscribe_data_on_redirect_url)){["email","phone","name","firstname","lastname"].map(t=>{e[t]&&(n[t]=e[t])});let t=_optJquery.param(n);i.indexOf("?")>0?i+="&"+t:i+="?"+t}const o=OptinlyHelpers.isTruthy(t.rules.redirectNewWindowOnPrimaryButtonClick);t.hide&&t.hide(),o?window.open(i):document.location.href=i}catch(e){console.log(e)}},0)}},OptinlyMain.prototype.getReCaptcha=function(){if("undefined"!=typeof grecaptcha)return!0;try{_optJquery.ajax({type:"GET",url:"https://www.google.com/recaptcha/api.js",dataType:"script",cache:!0})}catch(e){OptinlyHelpers.logger(e)}},OptinlyMain.prototype.ctaClicked=function(e){try{if(e&&e.useNew){let t=document.createElement("a");document.body.appendChild(t),t.style="display: none",t.href=e.url,t.target="_blank",t.click(),document.body.removeChild(t)}else window.location.href=e.url;OptinlyHelpers.setCookie("optinly_shown_"+this.campaign.campaign_id,"true",this.rules.cookieDuration,this.rules.ckd_unit)}catch(e){OptinlyHelpers.logger(e)}},OptinlyMain.prototype.OnInput=function(){},OptinlyMain.prototype.inputBlur=function(){};var OptinlyAjax={createCORSRequest:function(e,t=""){var i=new XMLHttpRequest;return t=t+((""+t).indexOf("?")>-1?"&_=":"?_=")+(new Date).getTime(),"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?((i=new XDomainRequest).open(e,t),i.setRequestHeader("cache-control","no-cache, must-revalidate, post-check=0, pre-check=0"),i.setRequestHeader("cache-control","max-age=0"),i.setRequestHeader("expires","0"),i.setRequestHeader("expires","Tue, 01 Jan 1980 1:00:00 GMT"),i.setRequestHeader("pragma","no-cache")):i=null,i},send:function(e,t){var i=OptinlyAjax.createCORSRequest("GET",e);i.onload=function(){var e=i.responseText;t(e,i)},i.onerror=function(){t("[]",i)},i.send()}};if(void 0===_opt)var _opt={};!function(e,t,i,n){var o,r,s=!1;if(!(o=e.jQuery)||"1.11.3"!=o.fn.jquery||n(o,s)){var a=t.createElement("script");a.type="text/javascript",a.src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js",a.onload=a.onreadystatechange=function(){s||(r=this.readyState)&&"loaded"!=r&&"complete"!=r||(n((o=e.jQuery).noConflict(1),s=!0),o(a).remove())},(t.getElementsByTagName("head")[0]||t.documentElement).appendChild(a)}}(window,document,0,function(e,t){if(window._optJquery=e||jQuery,window.OptinlyLoaded)return;window.optinly={},window.OptinlyCampaigns,window.OptinlyCampaigns=[];const i=OptinlyHelpers;window.OptinlyLoaded=!0,_opt.customerid=OptinlyHelpers.getCookie("optinly_customer_id"),e(window).on("message",function(t){var n=t.originalEvent.data;if("string"!=typeof n)return;var o=i.strIndexOf(n,"optinly-iframe")>-1;if(!o)return;try{n=e.parseJSON(n)}catch(t){OptinlyHelpers.logger(t,n)}const r=n.campaign_id;n&&n.type&&o&&e.each(OptinlyCampaigns,function(e,t){if(t.getCampaignId()!=r)return!0;switch(n.type){case"loaded":t.frameLoaded(n.width,n.height);break;case"resize":t.resizeCampaign(n.width,n.height);break;case"subscribed":t.onCloseOrSubscribed({subscribed:!0}),t.OnSubscribed(n.fields);break;case"input-focus":t.OnInput(n.posTop);break;case"input-blur":t.inputBlur(n.posTop);break;case"load-captcha":t.getReCaptcha(n);break;case"cta-clicked":t.ctaClicked(n);break;case"optinly-root-style":OptinlyHelpers.appendStyle(n.style);break;case"opt-iframe-click":t.onIframeClick(n.class_slug);break;case"close":t.onCloseOrSubscribed({close:!0}),t.hide(n.width,n.height)}})});let n,o,r,s;n="https://cdn.optinly.net/v1/",o="https://static.optinly.net/",r=(s="https://apinew.optinly.com/v1")+"/campaign/analytics";const a=(new Date).getTime();var c={init:function(){if(window.location.search.indexOf("optinly_hide=true")>-1)return 1;let e=this;this.ready=!1,this.campaigns=[],this.siteSettings=[],this.chosenCampaigns=[],this.is_shopify="object"==typeof Shopify,this.testWidgetIds={};let{site_id:t,campaign_id:i,embedded:n}=this.getSiteData();this.campaign_id=i,this.embedded=n,this.siteId=t,this._settingsUrl="",this._tracking=!1,this._trackingFlags="",this.siteId&&this.loadSite(),console.log("%c Optinly is running","color:#171874;font-weight:bold;padding:4px 6px 4px 0;border-radius:2px;");try{_optJquery.get("https://www.cloudflare.com/cdn-cgi/trace",function(t){e.locInfo=t})}catch(e){console.log(e)}try{this.localeInfo=Intl.DateTimeFormat().resolvedOptions()}catch(e){console.log(e)}},loadSite:function(){this._settingsUrl=o+"sites/"+this.siteId+"/settings.json",this.loadSiteSettings(),this.updateVisitorInfo()},updateVisitorInfo:function(){const e=OptinlyHelpers.getCookie("optinly_last_session_time"),t=e&&Math.floor((a-e)/6e4)>=10,i=parseInt(OptinlyHelpers.getCookie("optinly_sessions_count"))||0;e||(OptinlyHelpers.setCookie("optinly_last_session_time",a,90),OptinlyHelpers.setCookie("optinly_sessions_count",1,90)),t&&(OptinlyHelpers.setCookie("optinly_last_session_time",a,90),OptinlyHelpers.setCookie("optinly_sessions_count",i+1,90));const n=parseInt(OptinlyHelpers.getCookie("optinly_page_views_count"))||0;OptinlyHelpers.setCookie("optinly_page_views_count",n+1,90),this.views_count=n,this.sessions_count=i},loadSiteSettings:function(){const t=this;OptinlyAjax.send(t._settingsUrl,function(i){try{i=e.parseJSON(i),t.siteSettings=i,t.prepareCampaigns()}catch(e){}})},prepareCampaigns:function(){const t=this,i=this.siteSettings;let n=this.campaign_id;if(e.each(i,function(e,i){try{i.rules=JSON.parse(i.rules),i.rules.targetingRules=i.rules.targetingRules||[]}catch(e){OptinlyHelpers.logger("parsing rules ",e)}if(n)i.campaign_id===n&&t.campaigns.push(i);else{if(!t.shouldLoadCampaign(i.rules,i))return!0;t.campaigns.push(i)}}),i.length>0&&t.campaigns.length>0)return t.setupTests(),void t.formCampaignTypes();this.ready=!0},setupTests:function(){var t=this,i=e.grep(this.campaigns,function(e){return null==e.ab_test_id});this.chosenCampaigns=e.map(i,function(e){return e.id});var n=e.map(this.campaigns,function(e){return e.ab_test_id}),o=e.grep(n,function(t,i){return null!=t&&e.inArray(t,n)===i});e.each(o,function(i,n){var o=e.grep(t.campaigns,function(e){return e.ab_test_id==n}),r=e.map(o,function(e){return e.id}),s=o[Math.floor(Math.random()*r.length)];t.chosenCampaigns.push(s.id),t.testWidgetIds[n]=e.grep(r,function(e){return e!=s.id})})},shouldLoadCampaign:function(e,t){return!("object"!=typeof e.targetingRules||0!==e.targetingRules.length||"(true)"!==e.urlPath||!this.canShowOnThisDevice(e)||e.pageViewsRule||e.sessionsRule)||("all"===e.targetingRulesMatchType?this.canShowOnThisDevice(e)&&this.checkEnabledOnPage(e,!0)&&this.checkVisitorRules(e,t,!0)&&this.checkCookieRule(e,!0)&&this.timeZoneCheck(e,!0)&&this.countryCheck(e,!0)&&this.referrerCheck(e,!0):void 0===e.targetingRulesMatchType?this.canShowOnThisDevice(e)&&this.checkEnabledOnPage(e):this.canShowOnThisDevice(e)&&(this.checkEnabledOnPage(e,!1)||this.checkVisitorRules(e,t,!1)||this.checkCookieRule(e,!1)||this.timeZoneCheck(e,!1)||this.countryCheck(e,!1)||this.referrerCheck(e,!1)))},canShowOnThisDevice:function(e){var t=!0;return OptinlyHelpers.isDesktop()&&!e.showOnDesktop&&(t=!1),OptinlyHelpers.isMobile()&&!e.showOnMobile&&(t=!1),OptinlyHelpers.isTablet()&&!e.showOnTablet&&(t=!1),t},checkEnabledOnPage:OptinlyHelpers.checkEnabledOnPage,checkRule({condition:e,current_value:t,defined_value:i}){let n;switch(e){case"less-than":n=parseInt(t)<parseInt(i);break;case"more-than":n=parseInt(t)>parseInt(i);break;case"exactly":case"equals":n=t===i;break;case"contains":n=(""+t).indexOf(i)>-1;break;case"any":n=!0}return n},checkCookieRule:function(e,t=!1){const i=e.targetingRules.filter(e=>"cookie"===e.type),n="all"===e.targetingRulesMatchType;if(!i)return t;const o=OptinlyHelpers.getCookiePairs()||[];let r=[];return i.forEach(e=>{o.forEach(t=>{if(this.checkRule({condition:e.matchTypeCookieName,defined_value:e.cookieName,current_value:t.key})){const i=this.checkRule({condition:e.matchTypeCookieValue,defined_value:e.cookieValue,current_value:t.value});r.push(i)}})}),n?r.indexOf(!1)<0:r.indexOf(!0)>-1},timeZoneCheck:function(e,t){const i=e.targetingRules.filter(e=>"timezone"===e.type),n="all"===e.targetingRulesMatchType,o=this,r=this.localeInfo;if(i.length<1)return t;let s=[];try{return i.forEach(e=>{const t=o.checkRule({condition:"contains",defined_value:(""+r.timeZone).toLowerCase().trim(),current_value:(""+e.value).toLowerCase().trim()});s.push(t)}),n?s.indexOf(!1)<0:s.indexOf(!0)>-1}catch(e){return t}},isRuleMatchAll:(e={})=>"all"===e.targetingRulesMatchType,countryCheck:function(e,t){const i=e.targetingRules.filter(e=>"country"===e.type),n=this.isRuleMatchAll(e),o=this;let r=(this.locInfo||"").match("loc=(.*)");if(r&&(r=r[1]),i.length<1)return t;let s=[];try{return i.forEach(e=>{const t=o.checkRule({condition:"contains",defined_value:e.value,current_value:r});s.push(t)}),n?s.indexOf(!1)<0:s.indexOf(!0)>-1}catch(e){return console.log(e),t}},referrerCheck(e,t){const i=e.targetingRules.filter(e=>"referrer"===e.type),n=this.isRuleMatchAll(e),o=this;if(i.length<1)return t;let r=[];try{return i.forEach(e=>{const t=document.referrer.length>0&&o.checkRule({condition:"contains",defined_value:e.value,current_value:document.referrer});r.push(t)}),n?r.indexOf(!1)<0:r.indexOf(!0)>-1}catch(e){return console.log(e),t}},checkVisitorRules:function(e,t,i=!1){const n=!!e.pageViewsRule,o=!!e.sessionsRule;if(!e.pageViewsRule&&!e.sessionsRule)return i;const r={},s=function(e,t){const i=String(e).split("=");return{condition:i[0],defined_value:parseInt(i[1])||0,current_value:t}};n&&(r.pv=this.checkRule(s(e.pageViewsRule,this.views_count))),o&&(r.sv=this.checkRule(s(e.sessionsRule,this.sessions_count)));let a=!1;"all"===e.targetingRulesMatchType?Object.keys(r).map(e=>a=r[e]):Object.keys(r).map(e=>{a||(a=r[e])});return a},getCampaignVisitorInfo:function(e){const t={};return""!=OptinlyHelpers.getCookie("optinly_shown_"+e.campaign_id)&&(t.isExistingVisitor=!0),""!=OptinlyHelpers.getCookie("optinly_subscribed_"+e.campaign_id)&&(t.isExistingSubscriber=!0),t},getVisitorInfo:function(e){const t={};return""!=OptinlyHelpers.getCookie("optinly_shown_"+e.campaign_id)&&(t.AlreadyVisitorUser=!0),""!=OptinlyHelpers.getCookie("optinly_subscribed_"+e.campaign_id)&&(t.AlreadySubscribedUser=!0),t},getClassFromType:function(e){return String(e).split("-").filter(e=>e).map(e=>e=e.charAt(0).toUpperCase()+e.slice(1)).join("")},formCampaignTypes:function(){var t=this;let i=e.map(this.campaigns,function(e){t.getCampaignVisitorInfo(e);return e.type,e.type});i=i.filter((e,t)=>i.indexOf(e)==t);var o=e.map(i,function(e){return"undefined"==window["Optinly"+t.getClassFromType(e)]?null:n+e.toLowerCase()+".js"});o.length>0&&this.loadScripts(o,function(){t.loadCampaigns()})},loadScripts:function(t,i){var n=0;if(n!=t.length)for(var o=function(){++n===t.length&&i()},r=0;r<t.length;r++)e.ajax({type:"GET",url:t[r],success:o,dataType:"script",cache:!0});else i()},loadCampaigns:function(){var t=this;e.each(this.campaigns,function(e,i){i&&(i.type,1)&&t.loadCampaign(i)}),this.ready=!0},loadCampaign:function(t){if(this.isCurrentlyInUse(t)){var i=!0;e.inArray(t.id,this.chosenCampaigns)>-1&&(i=!1);const c=this.getClassFromType(t.type);t.site_id=this.siteId,t.isDev=!1,t.isBeta=!1,t.cdnBaseUrl=n,t.sitesBaseUrl=o,t.backendBaseUrl=s,t.analyticsUrl=r,t.visitorInfo=this.visitorInfo,t.embedded=this.embedded,this.setCampaignRuleToSession(t);var a=new window["Optinly"+c](t);i&&(a.hide_=!0),OptinlyHelpers.createLoadEvent(function(){OptinlyCampaigns.push(a),a.init()})}},setCampaignRuleToSession:function(e){try{"object"==typeof e&&e.campaign_id&&sessionStorage.setItem("optinly_campaign_rule_"+e.campaign_id,JSON.stringify(e.rules))}catch(e){OptinlyHelpers.logger(e)}},getSiteData:function(){var t=e("#optinly_script").attr("data-app_id"),i=e("#optinly_script").attr("data-campaign_id");if(this.is_shopify)try{let e=new URL(_optJquery('script[src*="optinly.js"]').attr("src"));t=new URLSearchParams(e.search).get("app_id")||t}catch(e){console.log("Optinly SiteId Missing",e)}return{site_id:t,campaign_id:i,embedded:"true"==e("#optinly_script").attr("data-embedded")}},isCurrentlyInUse:function(t){return e.inArray(t.id,this.chosenCampaigns)>-1}};OptinlyHelpers.loadCss(n+"styles.css"),c.init()});