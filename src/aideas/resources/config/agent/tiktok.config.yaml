# For TikTok, it is better to use the default cover (i.e. first scene), than to upload one
# Our videos are generated with the first scene having the cover image.
# [llm|browser|blog|generic]  llm is not yet supported
agent-type: browser
# Optional [generate-video|generate-text|post|test|custom|unlisted]
agent-tags: post
sort-order: 1
interval-seconds: 1
# Optional [visible|undetected]
browser-mode: undetected
form-field-source: $TEXT_FILE
stages:
  setup:
    events:
      onerror: continue
    stage-items:
      delete-cookies:
        actions: delete_cookies
  pre-login:
    url: https://www.tiktok.com/login/phone-or-email/email
    events:
      onerror: continue
    stage-items:
      accept-cookies:
        search-from: # /html/body/tiktok-cookie-banner//button[contains(text(), "Accept")]
          shadow-attributes: class=cookie-content
        search-for: # //*[contains(text(), "Accept")]
          shadow-attributes: type=button
  login:
    url: https://www.tiktok.com/login/phone-or-email/email
    events:
      onerror: ask_for_help "Please help by proceeding till you login." 60
    stage-items:
      enter-username:
        search-for: //*[@id="loginContainer"]//form//input[@name="username"]
        actions:
          - send_keys $TIKTOK_USER_EMAIL
          - wait 2
      enter-password:
        search-for: //*[@id="loginContainer"]//form//input[@type="password" and @placeholder="Password"]
        actions:
          - send_keys $TIKTOK_USER_PASS
          - wait 2
      submit-login:
        search-for: //*[@id="loginContainer"]//form/button[contains(text(), "Log")]
        actions:
          - click
          - wait 10 # Took a while to log in and arrive at target page
  cookie-options:
    events:
      onerror: continue
    stage-items:
      accept-cookies:
        search-for:
          - /tiktok-cookie-banner//button[contains(text(), “Decline optional cookies“)]
          - /tiktok-cookie-banner//*[contains(text(), “Decline optional cookies“)]
          - /tiktok-cookie-banner//button[1]
  enter-upload-video-details:
    url: https://www.tiktok.com/creator-center/upload?from=upload&lang=en
    stage-items:
      wait-a-bit:
        actions: wait 60
      add-upload-file:
        #timeout-seconds: 0 # Signal not to use webdriver wait
        # <input type="file" accept="video/*" multiple="" class="jsx-3397029100" style="display: none;">
        search-for:
          - //*[@id="root"]//input[@type="file" and @accept="video/*"]
          - //input[@type="file" and @accept="video/*"]
        actions:
          - enter_text $VIDEO_FILE_PORTRAIT
          - wait 10 # It takes a while but the default wait will cover the rest
      click-upload-button:
        events:
          onerror: continue
        timeout-seconds: 5
        search-for:
          - /html/body/div[1]/div/div[2]/div[1]/div/div[1]/button
          - //*[@id="root"]//*[@data-tt="Sidebar_index_UploadButtonContainer"]//button[contains(text(), "Upload")]
          - //*[@id="root"]//button[contains(text(), "Upload")]
      enter-video-caption:
#        when:
#          search-for:
#            - //*[@id="root"]//div[contains(@class, "edit-card")]//button[contains(text(), "Edit video")]
#            - //*[@id="root"]//button[contains(text(), "Edit video")]
#            - //*[@id="root"]/div/div/div[2]/div[2]/div/div/div/div[4]/div[2]/div/div[3]/div/button/div/div[2]
#          actions: is_displayed
        search-for:
#<div class="DraftEditor-editorContainer"><div aria-autocomplete="list" aria-expanded="false" class="notranslate public-DraftEditor-content" contenteditable="true" role="combobox" spellcheck="false" style="outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;"><div data-contents="true"><div class="" data-block="true" data-editor="cks97" data-offset-key="19fqd-0-0"><div data-offset-key="19fqd-0-0" class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr"><span data-offset-key="19fqd-0-0"><span data-text="true">video-portrait</span></span></div></div></div></div></div>
          - //*[@id="root"]//*[starts-with(@class, "DraftEditor-root")]//*[@data-contents="true"]//span[@data-text="true"]
          - //*[@id="root"]//*[@data-contents="true"]//span[@data-text="true"]
          - //*[@id="root"]//*[@data-text="true"]
        actions: enter_text $TEXT_CONTENT
  submit-video:
    stage-items:
      click-submit-video:
        search-for:
          - //*[@id="root"]//button[contains(text(), “Post”)]
          - //*[@id="root"]//button[@data-e2e="post_video_button"]
